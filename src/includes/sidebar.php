<?php
// sidebar.php
?>
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">
            <img src="WhatsApp Image 2025-05-15 à 00.54.47_42b83ab0.jpg" alt="SYGECOS">
        </div>
        <span class="sidebar-title">SYGECOS</span>
    </div>

    <nav class="sidebar-nav">
        <div class="nav-section">
            <div class="nav-section-title active">Navigation</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="dashHome.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Tableau de bord</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Paramètres généraux</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="gestion_type_util.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-user-tag"></i>
                        </div>
                        <span class="nav-text">Types utilisateur</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_groupes.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="nav-text">Groupes</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_utilisateur.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="nav-text">Utilisateurs</span>
                    </a>
                </div>
                
                <div class="nav-item">
                    <a href="gestion_traitements.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <span class="nav-text">Traitements</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Gestion académique</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="gestion_annee_academique.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <span class="nav-text">Année académique</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_ue.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <span class="nav-text">UE</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_ecue.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <span class="nav-text">ECUE</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Gestion Enseignant</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="gestion_dossier_enseignant.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-address-card"></i>
                        </div>
                        <span class="nav-text">Dossier de l'enseignant</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_fonctions_enseignants.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <span class="nav-text">Fonctions</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_specialites_enseignants.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <span class="nav-text">specialites</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="gestion_grade_enseignant.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <span class="nav-text">Grades</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Gestion Personnel Administratif</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="gestion_personnel_admin.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
         <span class="nav-text">Dossier du personnel </span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Commission de Validation</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="rapport_stage_commission.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <span class="nav-text">Rapports déposés</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="statuer_rapport.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <span class="nav-text">Statuer rapport</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="approbation_rapport.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <span class="nav-text">Approbation</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="reunion_commission.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="nav-text">Réunions</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Communication</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="messagerie_commission.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <span class="nav-text">Messagerie</span>
                    </a>
                </div>
            </div>
        </div>

        

        <div class="nav-section">
            <div class="nav-section-title">Piste d'audit</div>
            <div class="nav-items-wrapper">
                <div class="nav-item">
                    <a href="audit_tracabilite.php" class="nav-link">
                        <div class="nav-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <span class="nav-text">Traçabilité</span>
                    </a>
                </div>
                
            </div>
        </div>
    </nav>
</aside>

<style>
    /* === SIDEBAR === */
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: var(--sidebar-width);
        height: 100vh;
        background: linear-gradient(180deg, var(--primary-800) 0%, var(--primary-900) 100%);
        color: white;
        z-index: 1000;
        transition: all var(--transition-normal);
        overflow-y: scroll; /* Changed to scroll to hide scrollbar */
        overflow-x: hidden;
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }

    /* Hide scrollbar for Webkit browsers (Chrome, Safari) */
    .sidebar::-webkit-scrollbar {
        display: none;
    }

    .sidebar.collapsed {
        width: var(--sidebar-collapsed-width);
    }

    .sidebar-header {
        padding: var(--space-6) var(--space-6);
        border-bottom: 1px solid var(--primary-700);
        display: flex;
        align-items: center;
        gap: var(--space-3);
    }

    .sidebar-logo {
        width: 60px;
        height: 60px;
        background: var(--accent-500);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
    }

    .sidebar-logo img {
        display: block;
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        /* filter: brightness(0) invert(1); Si le logo a besoin d'être inversé */
    }
    .sidebar-title {
        font-size: var(--text-xl);
        font-weight: 700;
        white-space: nowrap;
        opacity: 1;
        transition: opacity var(--transition-normal);
    }

    .sidebar.collapsed .sidebar-title {
        opacity: 0;
    }

    .sidebar-nav {
        padding: var(--space-4) 0;
    }

    .nav-section {
        margin-bottom: var(--space-2); /* Adjusted margin for collapsed sections */
    }

    .nav-section-title {
        padding: var(--space-2) var(--space-6);
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--primary-400);
        white-space: nowrap;
        opacity: 1;
        transition: opacity var(--transition-normal);
        cursor: pointer; /* Make title clickable */
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .nav-section-title:hover { /* Hover effect for section titles */
        background-color: rgba(255, 255, 255, 0.05); /* Slightly lighter background on hover */
    }

    .sidebar.collapsed .nav-section-title {
        opacity: 0;
    }

    /* Remove caret icon styles as we are removing the icon itself */
    /* .nav-section-title .caret-icon {
        transition: transform var(--transition-normal);
    }

    .nav-section-title.active .caret-icon {
        transform: rotate(180deg);
    } */

    .nav-items-wrapper {
        max-height: 0;
        overflow: hidden;
        transition: max-height var(--transition-normal) ease-out;
    }

    .nav-section-title.active + .nav-items-wrapper {
        max-height: 500px; /* Adjust this value based on max content height */
        transition: max-height var(--transition-normal) ease-in;
    }

    .sidebar.collapsed .nav-items-wrapper {
        display: none; /* Hide content when sidebar is collapsed */
    }

    .nav-item {
        margin-bottom: var(--space-1);
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: var(--space-3) var(--space-6);
        color: var(--primary-200);
        text-decoration: none;
        transition: all var(--transition-fast);
        position: relative;
        gap: var(--space-3);
    }

    .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .nav-link.active {
        background: var(--accent-600);
        color: white;
    }

    .nav-link.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: var(--accent-300);
    }

    .nav-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .nav-text {
        white-space: nowrap;
        opacity: 1;
        transition: opacity var(--transition-normal);
    }

    .sidebar.collapsed .nav-text {
        opacity: 0;
    }

    .nav-submenu {
        margin-left: var(--space-8);
        margin-top: var(--space-2);
        border-left: 2px solid var(--primary-700);
        padding-left: var(--space-4);
    }

    .sidebar.collapsed .nav-submenu {
        display: none;
    }

    .nav-submenu .nav-link {
        padding: var(--space-2) var(--space-4);
        font-size: var(--text-sm);
    }

    /* === TOPBAR === */
    .topbar {
        height: var(--topbar-height);
        background: var(--white);
        border-bottom: 1px solid var(--gray-200);
        padding: 0 var(--space-6);
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: var(--shadow-sm);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .topbar-left {
        display: flex;
        align-items: center;
        gap: var(--space-4);
    }

    .sidebar-toggle {
        width: 40px;
        height: 40px;
        border: none;
        background: var(--gray-100);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-fast);
        color: var(--gray-600);
    }

    .sidebar-toggle:hover {
        background: var(--gray-200);
        color: var(--gray-800);
    }

    .page-title {
        font-size: var(--text-xl);
        font-weight: 600;
        color: var(--gray-800);
    }

    .topbar-right {
        display: flex;
        align-items: center;
        gap: var(--space-4);
    }

    .topbar-button {
        width: 40px;
        height: 40px;
        border: none;
        background: var(--gray-100);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-fast);
        color: var(--gray-600);
        position: relative;
    }

    .topbar-button:hover {
        background: var(--gray-200);
        color: var(--gray-800);
    }

    .notification-badge {
        position: absolute;
        top: -2px;
        right: -2px;
        width: 18px;
        height: 18px;
        background: var(--error-500);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
        color: white;
    }

    .user-menu {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: background var(--transition-fast);
    }

    .user-menu:hover {
        background: var(--gray-100);
    }

    .user-info {
        text-align: right;
    }

    .user-name {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--gray-800);
        line-height: 1.2;
    }

    .user-role {
        font-size: var(--text-xs);
        color: var(--gray-500);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const navSectionTitles = document.querySelectorAll('.nav-section-title');
        const navLinks = document.querySelectorAll('.nav-link');

        // Function to set the active link
        function setActiveLink() {
            // Remove 'active' class from all nav-links first
            navLinks.forEach(link => {
                link.classList.remove('active');
            });

            // Get the current URL path
            const currentPath = window.location.pathname.split('/').pop();

            // Find the nav-link that matches the current path and add 'active' class
            navLinks.forEach(link => {
                const linkHref = link.getAttribute('href');
                if (linkHref && linkHref.includes(currentPath)) {
                    link.classList.add('active');

                    // If the active link is inside a collapsed section, expand that section
                    let parentWrapper = link.closest('.nav-items-wrapper');
                    if (parentWrapper) {
                        let parentSectionTitle = parentWrapper.previousElementSibling;
                        if (parentSectionTitle && !parentSectionTitle.classList.contains('active')) {
                            parentSectionTitle.classList.add('active');
                            parentWrapper.style.maxHeight = parentWrapper.scrollHeight + "px";
                        }
                    }
                }
            });
        }

        // Call setActiveLink on page load
        setActiveLink();

        // Add click listener to each nav link to update active state immediately
        navLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                // Prevent default navigation to allow JS to handle class update first
                // event.preventDefault(); // Uncomment if you want full control over navigation

                // Remove active class from all links
                navLinks.forEach(item => item.classList.remove('active'));

                // Add active class to the clicked link
                this.classList.add('active');

                // If you prevented default, you would navigate here:
                // window.location.href = this.href;
            });
        });


        // Handle section title clicks for collapsing/expanding
        navSectionTitles.forEach(title => {
            title.addEventListener('click', function() {
                this.classList.toggle('active');

                const itemsWrapper = this.nextElementSibling;
                if (itemsWrapper) {
                    if (this.classList.contains('active')) {
                        itemsWrapper.style.maxHeight = itemsWrapper.scrollHeight + "px";
                    } else {
                        itemsWrapper.style.maxHeight = "0";
                    }
                }
            });
        });

    });
</script>